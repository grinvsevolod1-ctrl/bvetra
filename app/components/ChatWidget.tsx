'use client'
import React, { useState } from 'react'
export default function ChatWidget(){ const [open,setOpen]=useState(false); const [messages,setMessages]=useState([] as {role:string,text:string}[]); const [input,setInput]=useState('')
 const send=async()=>{ if(!input.trim()) return; const usr={role:'user',text:input}; setMessages(prev=>[...prev,usr]); setInput(''); try{ const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:usr.text})}); const data=await res.json(); setMessages(prev=>[...prev,{role:'assistant',text:data.reply||'Нет ответа'}]); }catch(err){ setMessages(prev=>[...prev,{role:'assistant',text:'Ошибка соединения'}]) }}
 return (<div className="fixed right-4 bottom-4 z-50">{open? (<div className="w-80 bg-black border border-gold rounded-2xl p-3 shadow-lg"><div className="h-48 overflow-auto mb-2">{messages.map((m,i)=>(<div key={i} className={m.role==='user'?'text-right text-white':'text-left text-gold'}>{m.text}</div>))}</div><div className="flex gap-2"><input className="flex-1 p-2 rounded bg-neutral-900" value={input} onChange={e=>setInput(e.target.value)} /><button onClick={send} className="px-3 py-2 bg-gold rounded">Отправить</button></div><button className="mt-2 text-sm text-muted" onClick={()=>setOpen(false)}>Закрыть</button></div>) : (<button onClick={()=>setOpen(true)} className="bg-gold text-black px-3 py-2 rounded-full">Чат</button>)}</div>)}
